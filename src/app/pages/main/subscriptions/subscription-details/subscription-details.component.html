<main class="subscriptions-main-wrapper flex flex-col w-full min-h-screen p-6">
  <!-- Breadcrumb -->
  <div class="mb-8">
    <app-breadcrumb
      [items]="[
        { label: 'Subscriptions Management', url: '/main/subscriptions' },
        { label: 'Subscription Details', url: '/main/subscriptions/details/' + subscriptionId }
      ]"
    ></app-breadcrumb>
  </div>

  <!-- Header Section -->
  <div class="flex items-center justify-between mb-8">
    <div class="flex items-center gap-4">
      <button 
        nz-button 
        nzType="default" 
        nzSize="large"
        (click)="onBack()"
        class="rounded-lg">
        <span nz-icon nzType="arrow-left"></span>
        <span>Back</span>
      </button>
      <div>
        <h1 class="text-[#4F4F4F] dark:text-gray-300 text-[28px] font-semibold mb-1">Subscription Details</h1>
        <p class="text-[#7A7A7A] dark:text-gray-400 text-[14px]" *ngIf="subscription">
          Reference: {{ subscription.reference }}
        </p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex items-center justify-center py-20">
    <nz-spin nzSize="large"></nz-spin>
  </div>

  <!-- Subscription Not Found -->
  <div *ngIf="!loading && !subscription" class="text-center py-20">
    <nz-empty nzNotFoundContent="Subscription not found"></nz-empty>
    <button nz-button nzType="primary" (click)="onBack()" class="mt-4 flex items-center justify-center">
      <span class="flex items-center">Return to Subscriptions</span>
    </button>
  </div>

  <!-- Subscription Details Content -->
  <div *ngIf="!loading && subscription" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    
    <!-- Main Content - Left Side -->
    <div class="lg:col-span-2 space-y-8">
      
      <!-- Personal Details Card -->
      <nz-card class="subscriptions-container rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600 mb-8" [nzBodyStyle]="{ padding: '32px' }">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-8 h-8 bg-[#E41C24]/10 rounded-full flex items-center justify-center">
            <span nz-icon nzType="user" class="text-[#E41C24]"></span>
          </div>
          <h2 class="text-[#4F4F4F] dark:text-gray-300 text-[20px] font-semibold mb-0">Personal Details</h2>
        </div>
        <nz-descriptions nzBordered [nzColumn]="{ xxl: 2, xl: 2, lg: 2, md: 1, sm: 1, xs: 1 }" class="custom-descriptions">
          <nz-descriptions-item nzTitle="First Name">
            <span class="text-[#4F4F4F] dark:text-gray-300 font-medium">{{ subscription.personalDetails.firstName }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Middle Name">
            <span class="text-[#4F4F4F] dark:text-gray-300 font-medium">{{ subscription.personalDetails.middleName }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Last Name">
            <span class="text-[#4F4F4F] dark:text-gray-300 font-medium">{{ subscription.personalDetails.lastName }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Email">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.personalDetails.email }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Phone">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.personalDetails.phone }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Date of Birth">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.personalDetails.dateOfBirth | date: 'longDate' }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Nationality">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.personalDetails.nationality }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="ID Number">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.personalDetails.idNumber }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Marital Status">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.personalDetails.maritalStatus }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Address" [nzSpan]="2">
            <span class="text-[#7A7A7A] dark:text-gray-400">{{ subscription.personalDetails.address }}</span>
          </nz-descriptions-item>
        </nz-descriptions>
      </nz-card>

      <!-- Next of Kin Details Card -->
      <nz-card class="subscriptions-container rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600" [nzBodyStyle]="{ padding: '32px' }">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-8 h-8 bg-[#E41C24]/10 rounded-full flex items-center justify-center">
            <span nz-icon nzType="team" class="text-[#E41C24]"></span>
          </div>
          <h2 class="text-[#4F4F4F] dark:text-gray-300 text-[20px] font-semibold mb-0">Next of Kin Details</h2>
        </div>
        <nz-descriptions nzBordered [nzColumn]="{ xxl: 2, xl: 2, lg: 2, md: 1, sm: 1, xs: 1 }" class="custom-descriptions">
          <nz-descriptions-item nzTitle="Full Name">
            <span class="text-[#4F4F4F] dark:text-gray-300 font-medium">{{ subscription.nextOfKinDetails.fullName }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Relationship">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.nextOfKinDetails.relationship }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Phone">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.nextOfKinDetails.phone }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Email">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.nextOfKinDetails.email }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Address" [nzSpan]="2">
            <span class="text-[#7A7A7A] dark:text-gray-400">{{ subscription.nextOfKinDetails.address }}</span>
          </nz-descriptions-item>
        </nz-descriptions>
      </nz-card>

      <!-- Employment Details Card -->
      <nz-card class="subscriptions-container rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600" [nzBodyStyle]="{ padding: '32px' }">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-8 h-8 bg-[#E41C24]/10 rounded-full flex items-center justify-center">
            <span nz-icon nzType="briefcase" class="text-[#E41C24]"></span>
          </div>
          <h2 class="text-[#4F4F4F] dark:text-gray-300 text-[20px] font-semibold mb-0">Employment Details</h2>
        </div>
        <nz-descriptions nzBordered [nzColumn]="{ xxl: 2, xl: 2, lg: 2, md: 1, sm: 1, xs: 1 }" class="custom-descriptions">
          <nz-descriptions-item nzTitle="Employment Status">
            <span class="text-[#4F4F4F] dark:text-gray-300 font-medium">{{ subscription.employmentDetails.employmentStatus }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Employer Name">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.employmentDetails.employerName }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Job Title">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.employmentDetails.jobTitle }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Monthly Income">
            <span class="text-[#E41C24] font-bold text-[16px]">{{ subscription.employmentDetails.monthlyIncome }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Years of Employment">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.employmentDetails.yearsOfEmployment }} years</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Work Address" [nzSpan]="1">
            <span class="text-[#7A7A7A] dark:text-gray-400">{{ subscription.employmentDetails.workAddress }}</span>
          </nz-descriptions-item>
        </nz-descriptions>
      </nz-card>

      <!-- Payment Details Card -->
      <nz-card class="subscriptions-container rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600" [nzBodyStyle]="{ padding: '32px' }">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-8 h-8 bg-[#E41C24]/10 rounded-full flex items-center justify-center">
            <span nz-icon nzType="credit-card" class="text-[#E41C24]"></span>
          </div>
          <h2 class="text-[#4F4F4F] dark:text-gray-300 text-[20px] font-semibold mb-0">Payment Details</h2>
        </div>
        <nz-descriptions nzBordered [nzColumn]="{ xxl: 2, xl: 2, lg: 2, md: 1, sm: 1, xs: 1 }" class="custom-descriptions">
          <nz-descriptions-item nzTitle="Property Purchased" [nzSpan]="2">
            <span class="text-[#4F4F4F] dark:text-gray-300 font-medium">{{ subscription.paymentDetails.propertyPurchased }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Total Units">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.paymentDetails.totalUnits }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Unit Price">
            <span class="text-[#E41C24] font-bold">{{ subscription.paymentDetails.unitPrice }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Total Amount">
            <span class="text-[#E41C24] font-bold text-[18px]">{{ subscription.paymentDetails.totalAmount }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Initial Deposit">
            <span class="text-[#10B981] font-bold">{{ subscription.paymentDetails.initialDeposit }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Payment Plan">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.paymentDetails.paymentPlan }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Source of Funds">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.paymentDetails.sourceOfFunds }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Property Usage" [nzSpan]="2">
            <span class="text-[#7A7A7A] dark:text-gray-400">{{ subscription.paymentDetails.propertyUsage }}</span>
          </nz-descriptions-item>
        </nz-descriptions>
      </nz-card>

      <!-- Realtor Details Card -->
      <nz-card class="subscriptions-container rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600" [nzBodyStyle]="{ padding: '32px' }">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-8 h-8 bg-[#E41C24]/10 rounded-full flex items-center justify-center">
            <span nz-icon nzType="home" class="text-[#E41C24]"></span>
          </div>
          <h2 class="text-[#4F4F4F] dark:text-gray-300 text-[20px] font-semibold mb-0">Realtor Details</h2>
        </div>
        <nz-descriptions nzBordered [nzColumn]="{ xxl: 2, xl: 2, lg: 2, md: 1, sm: 1, xs: 1 }" class="custom-descriptions">
          <nz-descriptions-item nzTitle="Realtor Name">
            <span class="text-[#4F4F4F] dark:text-gray-300 font-medium">{{ subscription.realtorDetails.name }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="License Number">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.realtorDetails.licenseNumber }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Phone">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.realtorDetails.phone }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Email">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.realtorDetails.email }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Agency" [nzSpan]="2">
            <span class="text-[#7A7A7A] dark:text-gray-400">{{ subscription.realtorDetails.agency }}</span>
          </nz-descriptions-item>
        </nz-descriptions>
      </nz-card>

      <!-- Customer Details Card -->
      <nz-card class="subscriptions-container rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600" [nzBodyStyle]="{ padding: '32px' }">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-8 h-8 bg-[#E41C24]/10 rounded-full flex items-center justify-center">
            <span nz-icon nzType="customer-service" class="text-[#E41C24]"></span>
          </div>
          <h2 class="text-[#4F4F4F] dark:text-gray-300 text-[20px] font-semibold mb-0">Customer Details</h2>
        </div>
        <nz-descriptions nzBordered [nzColumn]="{ xxl: 2, xl: 2, lg: 2, md: 1, sm: 1, xs: 1 }" class="custom-descriptions">
          <nz-descriptions-item nzTitle="Preferred Contact">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.customerDetails.preferredContactMethod }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="How did you hear about us">
            <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.customerDetails.hearAboutUs }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Investment Goals" [nzSpan]="2">
            <span class="text-[#7A7A7A] dark:text-gray-400">{{ subscription.customerDetails.investmentGoals }}</span>
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Additional Requests" [nzSpan]="2">
            <span class="text-[#7A7A7A] dark:text-gray-400">{{ subscription.customerDetails.additionalRequests }}</span>
          </nz-descriptions-item>
        </nz-descriptions>
      </nz-card>
    </div>

    <!-- Sidebar - Right Side -->
    <div class="lg:col-span-1">
      
      <!-- Status & Actions Card -->
      <nz-card class="subscriptions-container rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600 mb-8" [nzBodyStyle]="{ padding: '24px' }">
        <div class="text-center mb-6">
          <h3 class="text-[#4F4F4F] dark:text-gray-300 text-[18px] font-semibold mb-4">Subscription Status</h3>
          
          <!-- Status Badge -->
          <nz-tag [nzColor]="getStatusColor(subscription.status)" class="px-4 py-2 rounded-full font-medium text-[14px] mb-4">
            {{ subscription.status }}
          </nz-tag>
          
          <!-- Completion Progress -->
          <div class="mb-6">
            <div class="flex items-center justify-between mb-2">
              <span class="text-[#7A7A7A] dark:text-gray-400 text-[14px]">Completion</span>
              <span class="text-[#4F4F4F] dark:text-gray-300 font-medium">{{ getCompletionPercentage() }}%</span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
              <div 
                class="bg-[#E41C24] h-2 rounded-full transition-all duration-300" 
                [style.width.%]="getCompletionPercentage()">
              </div>
            </div>
          </div>
          
          <!-- Dates -->
          <div class="text-left space-y-2 text-[14px]">
            <div class="flex justify-between">
              <span class="text-[#7A7A7A] dark:text-gray-400">Submitted:</span>
              <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.submissionDate | date: 'mediumDate' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-[#7A7A7A] dark:text-gray-400">Last Updated:</span>
              <span class="text-[#4F4F4F] dark:text-gray-300">{{ subscription.lastUpdated | date: 'mediumDate' }}</span>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="space-y-3">
          <button 
            nz-button 
            nzType="primary" 
            nzBlock
            (click)="sendReminder()"
            [disabled]="subscription.status === 'Completed'">
            <span nz-icon nzType="mail"></span>
            <span>Send Reminder</span>
          </button>
          
          <button 
            nz-button 
            nzType="default" 
            nzBlock
            (click)="editSubscription()">
            <span nz-icon nzType="edit"></span>
            <span>Edit Subscription</span>
          </button>
          
          <button 
            nz-button 
            nzType="default" 
            nzBlock
            (click)="downloadForm()">
            <span nz-icon nzType="download"></span>
            <span>Download Form</span>
          </button>
        </div>
      </nz-card>
      
      <!-- Quick Summary Card -->
      <nz-card class="subscriptions-container rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600" [nzBodyStyle]="{ padding: '24px' }">
        <h3 class="text-[#4F4F4F] dark:text-gray-300 text-[18px] font-semibold mb-4">Quick Summary</h3>
        
        <div class="space-y-4">
          <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-lg">
            <span nz-icon nzType="user" class="text-[#E41C24]"></span>
            <div>
              <p class="text-[#4F4F4F] dark:text-gray-300 font-medium mb-0">{{ subscription.personalDetails.firstName }} {{ subscription.personalDetails.lastName }}</p>
              <p class="text-[#7A7A7A] dark:text-gray-400 text-[12px] mb-0">Primary Contact</p>
            </div>
          </div>
          
          <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-lg">
            <span nz-icon nzType="home" class="text-[#E41C24]"></span>
            <div>
              <p class="text-[#4F4F4F] dark:text-gray-300 font-medium mb-0">{{ subscription.paymentDetails.totalUnits }} Units</p>
              <p class="text-[#7A7A7A] dark:text-gray-400 text-[12px] mb-0">{{ subscription.paymentDetails.propertyPurchased }}</p>
            </div>
          </div>
          
          <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-lg">
            <span nz-icon nzType="dollar" class="text-[#E41C24]"></span>
            <div>
              <p class="text-[#4F4F4F] dark:text-gray-300 font-medium mb-0">{{ subscription.paymentDetails.totalAmount }}</p>
              <p class="text-[#7A7A7A] dark:text-gray-400 text-[12px] mb-0">Total Investment</p>
            </div>
          </div>
        </div>
      </nz-card>
    </div>
  </div>
</main>
