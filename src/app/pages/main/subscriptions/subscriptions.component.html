<main class="subscriptions-main-wrapper flex flex-col w-full min-h-screen p-6">
  <!-- Breadcrumb -->
  <div class="mb-8">
    <app-breadcrumb
      [items]="[{ label: 'Subscriptions Management', url: '/subscriptions' }]"
    ></app-breadcrumb>
  </div>

  <!-- Metrics Cards -->
  <div class="flex items-center gap-6 mb-8">
    @for(metric of subscriptionMetrics; track metric.id) {
      <nz-card class="subscriptions-container flex-1 rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600" [nzBodyStyle]="{ padding: '24px' }">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 rounded-full flex items-center justify-center"
               [ngStyle]="{ 'background-color': metric.color + '20' }">
            @if(metric.title === 'Total Subscriptions') {
              <span nz-icon nzType="team" [ngStyle]="{ color: metric.color }"></span>
            } @else {
              <span nz-icon nzType="calendar" [ngStyle]="{ color: metric.color }"></span>
            }
          </div>
          <p class="text-[#7A7A7A] dark:text-gray-400 text-[16px] font-medium mb-0">{{ metric.title }}</p>
        </div>
        
        <div class="flex items-center justify-between">
          <h2 class="text-[#4F4F4F] dark:text-gray-400 text-[32px] font-semibold mb-0">{{ metric.amount }}</h2>
          <nz-tag [nzColor]="metric.color">
            <span nz-icon nzType="arrow-up"></span>
            {{ metric.percentage }} This Month
          </nz-tag>
        </div>
      </nz-card>
    }
  </div>

  <!-- Subscription Growth Chart Section -->
  <nz-card class="subscriptions-container mb-8 gap-6 rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600" [nzBodyStyle]="{ padding: '24px' }">
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-[#E41C24]/10 rounded-full flex items-center justify-center">
          <span nz-icon nzType="line-chart" class="text-[#E41C24]"></span>
        </div>
        <h3 class="text-[#4F4F4F] dark:text-gray-400 text-[20px] font-semibold mb-0">Subscription Growth</h3>
      </div>
      
      <nz-select [(ngModel)]="selectedPeriod" class="w-40" nzSize="default">
        @for(period of periodOptions; track period) {
          <nz-option [nzValue]="period" [nzLabel]="period"></nz-option>
        }
      </nz-select>
    </div>
    
    <div class="mb-4">
      <h2 class="text-[#4F4F4F] dark:text-gray-400 text-[32px] font-bold mb-1">1,250</h2>
      <div class="flex items-center gap-2">
        <nz-tag nzColor="success">
          <span nz-icon nzType="arrow-up"></span>
          +182 subscriptions
        </nz-tag>
      </div>
    </div>
    
    <!-- Chart Container -->
    <div class="h-80 w-full">
      <canvas #chartCanvas></canvas>
    </div>
  </nz-card>

  <!-- Spacer -->
  <div class="h-8"></div>

  <!-- Recent Subscription Activity Section -->
  <nz-card class="subscriptions-container rounded-lg border-2 border-[#EEF2F6] dark:border-gray-600" [nzBodyStyle]="{ padding: '24px' }">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-[#4F4F4F] dark:text-gray-400 text-[24px] font-semibold mb-0">Recent Subscription Activity</h3>
      <button 
        nz-button 
        nzType="primary"
        nzSize="default"
        (click)="onExport()">
        <span nz-icon nzType="download" nzTheme="outline"></span>
        <span>Export</span>
      </button>
    </div>

    <!-- Custom Filter Bar -->
    <div class="p-4 border-b border-gray-200 dark:border-gray-600 mb-4">
      <div class="flex flex-col space-y-4 lg:flex-row lg:space-y-0 lg:space-x-4 lg:items-center lg:justify-between">
        
        <!-- Search Section -->
        <div class="flex-1 max-w-md">
          <app-search-bar
            placeholder="Search subscriptions..."
            (search)="onSearchTermChange($event)"
            class="w-full">
          </app-search-bar>
        </div>

        <!-- Date Range Filters -->
        <div class="flex items-center gap-4 flex-wrap">
          <div class="flex items-center gap-2">
            <span class="text-[#4F4F4F] dark:text-gray-400 text-sm whitespace-nowrap">Start Date</span>
            <nz-date-picker 
              [(ngModel)]="startDate"
              (ngModelChange)="onDateRangeChange()"
              nzFormat="yyyy-MM-dd"
              nzPlaceHolder="Start Date"
              class="w-40">
            </nz-date-picker>
          </div>
          
          <div class="flex items-center gap-2">
            <span class="text-[#4F4F4F] dark:text-gray-400 text-sm whitespace-nowrap">End Date</span>
            <nz-date-picker 
              [(ngModel)]="endDate"
              (ngModelChange)="onDateRangeChange()"
              nzFormat="yyyy-MM-dd"
              nzPlaceHolder="End Date"
              class="w-40">
            </nz-date-picker>
          </div>
        </div>
      </div>
    </div>

    <!-- Subscriptions Table using reusable app-table component -->
    <app-table
      [data]="subscriptions"
      [columns]="columns"
      [actions]="actions"
      [loading]="loading"
      [serverMode]="true"
      [totalCount]="total"
      [page]="pageIndex"
      [pageSize]="pageSize"
      [showSearch]="false"
      [showFilters]="false"
      [showSelection]="true"
      [showPagination]="true"
      [showExport]="false"
      [responsive]="true"
      (actionClick)="onTableAction($event)"
      (selectionChange)="onSelectionChange($event)"
      (pageChange)="onPageChange($event)"
      class="w-full">
    </app-table>
  </nz-card>
</main>
